# PostgreSQL WAL Archiving Configuration
# ===========================================
# This file enables continuous WAL archiving for Point-in-Time Recovery (PITR).
#
# How it works:
# - PostgreSQL writes WAL segments (16MB files by default) as transactions occur
# - archive_command copies completed WAL segments to /var/lib/postgresql/wal_archive
# - Combined with a base backup, WAL archives enable recovery to any point in time
#
# For PITR restore, see docs/DISASTER_RECOVERY.md

# Enable WAL archiving
# 'replica' level includes enough info for PITR and standby replication
wal_level = replica

# Turn on archiving
archive_mode = on

# Archive command: copy WAL files to archive directory
# %p = path to WAL file to archive
# %f = filename only (no path)
# The command must return 0 only if successful to avoid WAL loss
archive_command = 'test ! -f /var/lib/postgresql/wal_archive/%f && cp %p /var/lib/postgresql/wal_archive/%f'

# Force archive switch after 5 minutes of inactivity (300 seconds)
# This limits data loss in low-write scenarios
# Set to 0 to disable (not recommended for PITR)
archive_timeout = 300

# WAL segment size (default 16MB, cannot be changed without initdb)
# Documented here for reference
# wal_segment_size = 16MB

# Keep at least this many WAL segments for crash recovery
# Higher values increase disk usage but improve recovery reliability
min_wal_size = 80MB
max_wal_size = 1GB

# Checkpoint settings for balanced performance and recovery
checkpoint_completion_target = 0.9
