# Production FastAPI configuration (.env format)
# All values are strings unless noted. Keep secrets out of source control.

##### Core app & HTTP #####
APP_NAME=cleaning-economy-bot
APP_ENV=prod
STRICT_CORS=true
TRUST_PROXY_HEADERS=true
CORS_ORIGINS=["https://app.example.com","https://admin.example.com"]  # JSON array or comma-separated string
TRUSTED_PROXY_IPS=["10.0.0.0/8","192.168.0.0/16"]
TRUSTED_PROXY_CIDRS=[]
PUBLIC_BASE_URL=https://app.example.com

##### Rate limiting & safety rails #####
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_CLEANUP_MINUTES=15
TIME_OVERRUN_REASON_THRESHOLD=1.2

##### Redis (rate limiting, caching, jobs) #####
REDIS_URL=redis://redis-primary:6379/0

##### Database #####
DATABASE_URL=postgresql+psycopg://clean_user:${POSTGRES_PASSWORD}@postgres-primary:5432/cleaning
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=5
DATABASE_POOL_TIMEOUT_SECONDS=30.0
DATABASE_STATEMENT_TIMEOUT_MS=5000

##### Authentication & sessions #####
# Replace with a strong, random secret (required in production)
AUTH_SECRET_KEY=
AUTH_TOKEN_TTL_MINUTES=1440
AUTH_ACCESS_TOKEN_TTL_MINUTES=15
AUTH_REFRESH_TOKEN_TTL_MINUTES=20160
AUTH_SESSION_TTL_MINUTES=1440
PASSWORD_HASH_SCHEME=argon2id
PASSWORD_HASH_ARGON2_TIME_COST=3
PASSWORD_HASH_ARGON2_MEMORY_COST=65536
PASSWORD_HASH_ARGON2_PARALLELISM=2
PASSWORD_HASH_BCRYPT_COST=12
SESSION_TTL_MINUTES_WORKER=720
SESSION_TTL_MINUTES_CLIENT=10080
SESSION_ROTATION_GRACE_MINUTES=5
CLIENT_PORTAL_SECRET=
WORKER_PORTAL_SECRET=
CLIENT_PORTAL_TOKEN_TTL_MINUTES=30
CLIENT_PORTAL_BASE_URL=https://portal.example.com

##### Access control (basic auth fallbacks) #####
LEGACY_BASIC_AUTH_ENABLED=false
OWNER_BASIC_USERNAME=
OWNER_BASIC_PASSWORD=
ADMIN_BASIC_USERNAME=admin
ADMIN_BASIC_PASSWORD=change-me-admin-basic-please-rotate
DISPATCHER_BASIC_USERNAME=dispatcher
DISPATCHER_BASIC_PASSWORD=change-me
ACCOUNTANT_BASIC_USERNAME=accountant
ACCOUNTANT_BASIC_PASSWORD=change-me-accountant-basic
VIEWER_BASIC_USERNAME=viewer
VIEWER_BASIC_PASSWORD=change-me
WORKER_BASIC_USERNAME=worker
WORKER_BASIC_PASSWORD=change-me-worker-basic
WORKER_TEAM_ID=1

##### Notifications #####
ADMIN_NOTIFICATION_EMAIL=ops@example.com

##### Pricing & billing #####
PRICING_CONFIG_PATH=pricing/economy_v1.json
DEPOSIT_PERCENT=0.25
DEPOSIT_CURRENCY=cad
DEFAULT_WORKER_HOURLY_RATE_CENTS=2500
SLOT_PROVIDER_MODE=db

##### Stripe #####
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_SUCCESS_URL=https://app.example.com/deposit-success?session_id={CHECKOUT_SESSION_ID}
STRIPE_CANCEL_URL=https://app.example.com/deposit-cancelled
STRIPE_INVOICE_SUCCESS_URL=https://app.example.com/invoice-success?session_id={CHECKOUT_SESSION_ID}
STRIPE_INVOICE_CANCEL_URL=https://app.example.com/invoice-cancelled
STRIPE_BILLING_SUCCESS_URL=https://app.example.com/billing/success?session_id={CHECKOUT_SESSION_ID}
STRIPE_BILLING_CANCEL_URL=https://app.example.com/billing/cancelled
STRIPE_BILLING_PORTAL_RETURN_URL=https://app.example.com/billing
STRIPE_CIRCUIT_FAILURE_THRESHOLD=5
STRIPE_CIRCUIT_RECOVERY_SECONDS=30.0

##### Email #####
EMAIL_MODE=smtp  # or sendgrid
EMAIL_FROM=no-reply@example.com
EMAIL_FROM_NAME=Cleaning Ops
SENDGRID_API_KEY=
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USERNAME=apikey
SMTP_PASSWORD=
SMTP_USE_TLS=true
EMAIL_MAX_RETRIES=3
EMAIL_RETRY_BACKOFF_SECONDS=60.0
EMAIL_HTTP_MAX_ATTEMPTS=3
EMAIL_HTTP_BACKOFF_SECONDS=1.0
EMAIL_HTTP_BACKOFF_MAX_SECONDS=8.0
EMAIL_TIMEOUT_SECONDS=10.0
SMTP_TIMEOUT_SECONDS=10.0
EMAIL_CIRCUIT_FAILURE_THRESHOLD=5
EMAIL_CIRCUIT_RECOVERY_SECONDS=30.0
EMAIL_UNSUBSCRIBE_SECRET=
EMAIL_UNSUBSCRIBE_TTL_MINUTES=10080

##### Exports / webhooks #####
EXPORT_MODE=off  # off|webhook|sheets
EXPORT_WEBHOOK_URL=https://ops.example.com/hooks/booking
EXPORT_WEBHOOK_TIMEOUT_SECONDS=5
EXPORT_WEBHOOK_MAX_RETRIES=5
EXPORT_WEBHOOK_BACKOFF_SECONDS=2.0
EXPORT_WEBHOOK_ALLOWED_HOSTS=["ops.example.com"]
EXPORT_WEBHOOK_ALLOW_HTTP=false
EXPORT_WEBHOOK_BLOCK_PRIVATE_IPS=true

##### Captcha #####
CAPTCHA_MODE=turnstile
TURNSTILE_SECRET_KEY=

##### Storage (photos/uploads) #####
ORDER_STORAGE_BACKEND=s3
ORDER_UPLOAD_ROOT=var/uploads/orders
ORDER_PHOTO_MAX_BYTES=10485760
ORDER_PHOTO_ALLOWED_MIMES_RAW=["image/jpeg","image/png","image/webp"]
ORDER_PHOTO_SIGNED_URL_TTL_SECONDS=600
ORDER_PHOTO_SIGNING_SECRET=
S3_ENDPOINT=https://s3.us-west-2.amazonaws.com
S3_BUCKET=cleaning-uploads
S3_ACCESS_KEY=
S3_SECRET_KEY=
S3_REGION=us-west-2
S3_CONNECT_TIMEOUT_SECONDS=3.0
S3_READ_TIMEOUT_SECONDS=10.0
S3_MAX_ATTEMPTS=4
R2_ENDPOINT=https://<accountid>.r2.cloudflarestorage.com
R2_BUCKET=cleaning-uploads
R2_ACCESS_KEY=
R2_SECRET_KEY=
R2_REGION=auto
R2_PUBLIC_BASE_URL=https://cdn.example.com
STORAGE_DELETE_RETRY_INTERVAL_SECONDS=30
STORAGE_DELETE_MAX_ATTEMPTS=5
STORAGE_DELETE_BATCH_SIZE=50

##### Metrics & observability #####
METRICS_ENABLED=true
METRICS_TOKEN=

##### Jobs #####
JOB_HEARTBEAT_REQUIRED=true
JOB_HEARTBEAT_TTL_SECONDS=300

##### Retention #####
RETENTION_CHAT_DAYS=30
RETENTION_LEAD_DAYS=365
RETENTION_ENABLE_LEADS=true

##### Misc #####
INVOICE_PUBLIC_TOKEN_SECRET=
DEPOSITS_ENABLED=true
DEFAULT_ORG_ID=00000000-0000-0000-0000-000000000001
TESTING=false
