services:
  api:
    environment:
      DATABASE_URL: postgresql+psycopg://postgres:postgres@db:5432/cleaning
    command:
      [
        "sh",
        "-lc",
        "alembic upgrade head && uvicorn app.main:app --host 0.0.0.0 --port 8000",
      ]
    ports:
      - "8000:8000"

  web:
    environment:
      NEXT_PUBLIC_API_BASE_URL: "http://127.0.0.1:8000"
      NEXT_PUBLIC_E2E_MODE: "true"
    build:
      args:
        NEXT_PUBLIC_API_BASE_URL: "http://127.0.0.1:8000"
        NEXT_PUBLIC_E2E_MODE: "true"
    ports:
      - "3000:3000"
